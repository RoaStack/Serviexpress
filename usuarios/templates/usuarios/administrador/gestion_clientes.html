{% extends 'base.html' %}
{% load static %}

{% block title %}Gesti√≥n de Clientes{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'usuarios/css/gestion_clientes.css' %}">
{% endblock %}

{% block body_class %}dashboard-body{% endblock %}
{% block main_class %}p-0 m-0 w-100{% endblock %}

{% block content %}

<div class="gc-wrapper">
  <div class="gc-overlay">

    <!-- üîô Bot√≥n volver -->
    <div class="gc-back-container">
        <a href="{% url 'reservas:selector_usuario' %}" class="gc-btn-back">
            ‚Üê Volver al selector de usuarios
        </a>
    </div>

    <!-- T√≠tulo principal -->
    <h1 class="gc-title">Gesti√≥n De Clientes</h1>
    <p class="gc-subtitle">
      Creaci√≥n, listado y gesti√≥n de usuarios (Clientes)
    </p>

    <!-- Botones superiores -->
    <div class="gc-top-actions">
      <a href="{% url 'usuarios:crear_cliente' %}" class="gc-btn gc-btn-orange">
        Crear Cliente
      </a>
    </div>

    <!-- Contador -->
    <div class="gc-counter">
      Cantidad de Clientes: {{ total_clientes }}
    </div>

    <!-- Tabla con scroll -->
    <div class="gc-table-wrapper">
      <table class="gc-table">
        <thead>
          <tr>
            <th>RUT</th>
            <th>Direcci√≥n</th>
            <th>Comuna</th>
            <th>Tel√©fono</th>
            <th>Usuario</th>
            <th>Nombre</th>
            <th>Apellido</th>
            <th>Correo</th>
            <th>Acciones</th>
          </tr>
        </thead>

        <tbody>
        {% for c in clientes %}
          <tr>
            <td>{{ c.rut }}</td>
            <td>{{ c.direccion }}</td>
            <td>{{ c.comuna }}</td>
            <td>{{ c.telefono }}</td>
            <td>{{ c.user.username }}</td>
            <td>{{ c.user.first_name }}</td>
            <td>{{ c.user.last_name }}</td>
            <td>{{ c.user.email }}</td>

            <td class="gc-actions-cell">
              <a href="{% url 'usuarios:editar_cliente' c.id %}"
                 class="gc-btn-table gc-btn-edit">
                Editar
              </a>

              <form method="post"
                    action="{% url 'usuarios:eliminar_cliente' c.id %}"
                    class="d-inline eliminar-form">
                {% csrf_token %}
                <button type="submit"
                        class="gc-btn-table gc-btn-delete btn-eliminar">
                  Eliminar
                </button>
              </form>
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="10" class="gc-empty">
              No hay clientes registrados a√∫n.
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>

  </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
document.addEventListener("DOMContentLoaded", () => {
  const botonesEliminar = document.querySelectorAll(".btn-eliminar");

  botonesEliminar.forEach((btn) => {
    btn.addEventListener("click", (e) => {
      const confirmado = confirm(
        "‚ö†Ô∏è ¬øEst√°s seguro de eliminar este cliente?\nEsta acci√≥n no se puede deshacer."
      );
      if (!confirmado) {
        e.preventDefault();
      }
    });
  });
});
</script>
{% endblock %}
