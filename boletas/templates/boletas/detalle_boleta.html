{% extends 'base.html' %}
{% load static %}

{% block title %}Boleta #{{ boleta.id }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/detalle_boleta.css' %}">
{% endblock %}

{% block body_class %}{{ body_class }}{% endblock %}
{% block main_class %}p-0 m-0 w-100{% endblock %}

{% block content %}
<div class="container my-5 bd-container">

  <div class="bd-card">

    <!-- Header -->
    <div class="bd-card-header text-center">
      ðŸ§¾ Boleta de Servicio #{{ boleta.id }}
    </div>

    <!-- Body -->
    <div class="bd-card-body">

      <!-- SecciÃ³n Superior (Cliente / Info) -->
      <div class="bd-section-group">
        <div>
          <h5 class="bd-section-title">ðŸ‘¤ Cliente</h5>
          <p class="bd-text-line">
            <span class="bd-text-label">Nombre:</span> 
            {{ boleta.cliente.user.get_full_name }}
          </p>
          <p class="bd-text-line">
            <span class="bd-text-label">Usuario:</span> 
            {{ boleta.cliente.user.username }}
          </p>
        </div>

        <div class="text-md-end">
          <h5 class="bd-section-title">ðŸ“… InformaciÃ³n</h5>
          <p class="bd-text-line">
            <span class="bd-text-label">Fecha emisiÃ³n:</span> 
            {{ boleta.fecha }}
          </p>
          <p class="bd-text-line">
            <span class="bd-text-label">Reserva asociada:</span> 
            #{{ boleta.reserva.id }}
          </p>
        </div>
      </div>

      <!-- Servicios Realizados -->
      <h4 class="bd-section-title mt-4">ðŸ§° Servicios Realizados</h4>
      <div class="bd-table-wrapper">
        <table class="bd-table">
          <thead>
            <tr>
              <th>Servicio</th>
              <th>Precio</th>
            </tr>
          </thead>
          <tbody>
            {% for s in boleta.detalles_servicios.all %}
            <tr>
              <td>{{ s.servicio.nombre }}</td>
              <td>${{ s.precio_servicio|floatformat:0 }}</td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="2" class="bd-muted">No hay servicios registrados.</td>
            </tr>
            {% endfor %}
          </tbody>
          <tfoot>
            <tr class="bd-row-total">
              <td>Total Servicios</td>
              <td>${{ total_servicios|floatformat:0 }}</td>
            </tr>
          </tfoot>
        </table>
      </div>

      <!-- Repuestos -->
      <h4 class="bd-section-title mt-4">ðŸ”© Repuestos Utilizados</h4>
      <div class="bd-table-wrapper">
        <table class="bd-table">
          <thead>
            <tr>
              <th>Repuesto</th>
              <th>Cantidad</th>
              <th>Precio Unitario</th>
              <th>Subtotal</th>
            </tr>
          </thead>
          <tbody>
            {% for r in boleta.detalles_repuestos.all %}
            <tr>
              <td>{{ r.repuesto.descripcion }}</td>
              <td>{{ r.cantidad }}</td>
              <td>${{ r.precio_unitario|floatformat:0 }}</td>
              <td>${{ r.subtotal|floatformat:0 }}</td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="4" class="bd-muted">No se registraron repuestos.</td>
            </tr>
            {% endfor %}
          </tbody>
          <tfoot>
            <tr class="bd-row-total">
              <td colspan="3">Total Repuestos</td>
              <td>${{ total_repuestos|floatformat:0 }}</td>
            </tr>
          </tfoot>
        </table>
      </div>

      <!-- Total General -->
      <div class="bd-total-row">
        <span class="bd-total-label">Total General:</span>
        <span class="bd-total-value">${{ total_general|floatformat:0 }}</span>
      </div>

      <!-- Botones -->
      <div class="bd-actions">
        <a href="{% url volver_url %}" class="bd-btn-back">
            {{ volver_text }}
        </a>


        <a href="#" class="bd-btn-ghost bd-btn-disabled">
          ðŸ’¾ Descargar PDF (prÃ³ximamente)
        </a>
      </div>

    </div>

    <!-- Footer -->
    <div class="bd-card-footer">
      Â© ServiExpress â€” Sistema de GestiÃ³n de Taller MecÃ¡nico
    </div>

  </div>
</div>
{% endblock %}
